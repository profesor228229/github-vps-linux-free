- name: Start VPS
  env:
    NGROK_AUTH: ${{ secrets.NGROK_AUTH }}
  run: |
    # Обновляем пакеты и устанавливаем SSH
    sudo apt update && sudo apt install -y openssh-server
    
    # Включаем автоматический старт SSH при перезагрузке
    sudo systemctl enable ssh
    
    # Перезапускаем SSH для применения изменений
    sudo systemctl restart ssh
    
    # Меняем пароль root (здесь будет пароль "root")
    echo "root:root" | sudo chpasswd
    
    # Разрешаем вход по SSH для root
    echo "PermitRootLogin yes" | sudo tee -a /etc/ssh/sshd_config
    echo "PasswordAuthentication yes" | sudo tee -a /etc/ssh/sshd_config
    
    # Перезапускаем SSH еще раз после изменения конфига
    sudo systemctl restart ssh
    
    # Проверяем статус SSH (для отладки)
    sudo systemctl status ssh --no-pager
    
    # Выводим открытые порты (для отладки)
    sudo netstat -tuln | grep ':22'
    
    # Авторизуемся в Ngrok и запускаем туннель
    ngrok authtoken $NGROK_AUTH
    ngrok tcp 22
